<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>VR Explorer</title>

<link rel="manifest" href="/ExplorerTest7/manifest.json">

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-title" content="VR Explorer">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<link rel="apple-touch-icon" href="/ExplorerTest7/icons/icon-192.png">

<style>
body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: #000;
    color: #fff;
    text-align: center;
}

.container {
    margin-top: 40px;
    display: flex;
    flex-direction: column;
    align-items: center;
}

h1 {
    font-size: 2.8rem;
    margin-bottom: 10px;
}

h2 {
    margin-top: 20px;
    font-size: 1.6rem;
    font-weight: 600;
}

label {
    display: block;
    margin-top: 15px;
    font-size: 1rem;
    color: #dfeeff;
    text-align: center;
}

select {
    width: 80%;
    max-width: 350px;
    padding: 14px;
    margin-top: 6px;
    font-size: 1.2rem;
    border-radius: 10px;
    border: none;
    outline: none;
    background: #111;
    color: white;
    appearance: none;
    cursor: pointer;
    background-image:
        linear-gradient(45deg, transparent 50%, #555 50%),
        linear-gradient(135deg, #555 50%, transparent 50%),
        linear-gradient(to right, #555, #555);
    background-position:
        calc(100% - 20px) calc(1.2em),
        calc(100% - 15px) calc(1.2em),
        calc(100% - 2.5em) 0.5em;
    background-size:
        6px 6px,
        6px 6px,
        1px 1.5em;
    background-repeat: no-repeat;
}

.or-text {
    margin: 12px 0;
    font-size: 1rem;
    color: #dfeeff;
}

button#openBtn {
    margin-top: 12px;
    padding: 15px 25px;
    font-size: 1.3rem;
    color: #fff;
    border: none;
    border-radius: 12px;
    cursor: pointer;
    width: 80%;
    max-width: 350px;
    background-color: #555;
}

button#openBtn.active {
    background-color: #28a745;
}

footer {
    margin-top: 40px;
    font-size: 0.75rem;
    font-style: italic;
    opacity: 0.8;
    margin-bottom: 20px;
}

#playerWrap {
    position: fixed;
    inset: 0;
    display: none;
    background: #000;
    z-index: 1000;
    align-items: center;
    justify-content: center;
    flex-direction: column;
}
#playerWrap iframe {
    width: 100%;
    height: 100%;
    border: 0;
}
#playerWrap .player-toolbar {
    position: absolute;
    top: 10px;
    left: 10px;
    z-index: 1010;
}
#playerWrap .player-toolbar button {
    padding: 8px 12px;
    border-radius: 8px;
    border: none;
    background: rgba(255,255,255,0.15);
    color: #fff;
    cursor: pointer;
}
</style>
</head>
<body>

<div class="container" id="home">
    <h1>VR Explorer</h1>
    <h2>Step 1: Select Simulation</h2>

    <label for="audienceSelect">Audience Sizes:</label>
    <select id="audienceSelect">
        <option value="">-- Select --</option>
        <option value="https://player.virtualrealitypublicspeaking.com/?video=N0-CF">Audience of 0</option>
        <option value="https://player.virtualrealitypublicspeaking.com/?video=N1-CF">Audience of 1</option>
        <option value="https://player.virtualrealitypublicspeaking.com/?video=N2-CF">Audience of 2</option>
        <option value="https://player.virtualrealitypublicspeaking.com/?video=N4-CF">Audience of 4</option>
        <option value="https://player.virtualrealitypublicspeaking.com/?video=N9-CF">Audience of 9</option>
        <option value="https://player.virtualrealitypublicspeaking.com/?video=N16-CF">Audience of 16</option>
        <option value="https://player.virtualrealitypublicspeaking.com/?video=N25-CF">Audience of 25</option>
        <option value="https://player.virtualrealitypublicspeaking.com/?video=N50-CF">Audience of 50</option>
        <option value="https://player.virtualrealitypublicspeaking.com/?video=N100-CF">Audience of 100</option>
        <option value="https://player.virtualrealitypublicspeaking.com/?video=N500-CF">Audience of 500</option>
        <option value="https://player.virtualrealitypublicspeaking.com/?video=N10K-CF">Audience of 1000s</option>
    </select>

    <div class="or-text">or</div>

    <label for="scenarioSelect">Special Scenarios:</label>
    <select id="scenarioSelect">
        <option value="">-- Select --</option>
        <option value="https://player.virtualrealitypublicspeaking.com/?video=ACC01-CF">TV teleprompter</option>
        <option value="https://player.virtualrealitypublicspeaking.com/?video=JIC01-CF">Job interview</option>
        <option value="https://player.virtualrealitypublicspeaking.com/?video=RIC01-CF">Radio interview</option>
    </select>

    <h2>Step 2: Enter Simulation</h2>
    <button id="openBtn">Go</button>

    <footer>VR Explorer 1.1 brought to you by Cambridge VR</footer>
</div>

<div id="playerWrap"></div>

<script>
const audienceSel = document.getElementById("audienceSelect");
const scenarioSel = document.getElementById("scenarioSelect");
const openBtn = document.getElementById("openBtn");
const playerWrap = document.getElementById("playerWrap");

let selectedURL = "";

// Detect iOS
const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;

function updateSelection(){
    selectedURL = audienceSel.value || scenarioSel.value;
    if(selectedURL) openBtn.classList.add("active");
    else openBtn.classList.remove("active");
}

audienceSel.addEventListener("change", ()=>{
    scenarioSel.value="";
    updateSelection();
});
scenarioSel.addEventListener("change", ()=>{
    audienceSel.value="";
    updateSelection();
});

openBtn.addEventListener("click", ()=>{
    if(!selectedURL) return;
    if(isIOS){
        window.open(selectedURL, "_blank"); // iOS: open in new tab for full VR interactivity
    } else {
        openVR(selectedURL); // Android/Desktop: iframe
    }
});

function openVR(url){
    playerWrap.innerHTML="";
    const toolbar = document.createElement("div");
    toolbar.className="player-toolbar";
    const exitBtn = document.createElement("button");
    exitBtn.textContent="Exit VR";
    exitBtn.onclick = closeVR;
    toolbar.appendChild(exitBtn);
    const iframe = document.createElement("iframe");
    iframe.src = url;
    iframe.allow = "autoplay; fullscreen; accelerometer; gyroscope; xr-spatial-tracking";
    playerWrap.appendChild(toolbar);
    playerWrap.appendChild(iframe);
    playerWrap.style.display="flex";
}

function closeVR(){
    playerWrap.style.display="none";
    playerWrap.innerHTML="";
}

// Service worker
if("serviceWorker" in navigator){
    navigator.serviceWorker.register("/ExplorerTest7/sw.js");
}
</script>
</body>
</html>
